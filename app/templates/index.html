{% extends "base.html" %} {% block content %}
<div class="mb-3">
	<div class="container mt-3">
		{% if current_user.is_authenticated %} {% block post_comment %}
		<form
			class="d-flex flex-column align-items-start gap-1"
			action="."
			method="POST">
			<textarea
				class="form-control bg-secondary-subtle"
				name="contents"
				placeholder="Post a new comment..."
				rows="5"
				style="resize: none"></textarea>
			<button
				class="btn btn-success"
				type="submit">
				Post
			</button>
		</form>
		{% endblock %} {% else %}
		<div class="fs-4 text-bg-danger text-center p-2">
			You must be logged in to interact with the comment forum.
		</div>
		<div class="d-flex justify-content-center align-items-center gap-3 p-3">
			<a
				class="btn btn-primary fs-5"
				href="{{ url_for('login') }}"
				>LOGIN</a
			>
			<span>or</span>
			<a
				class="btn btn-primary fs-5"
				href="{{ url_for('register') }}"
				>REGISTER</a
			>
		</div>
		{% endif %} {% block body %}{% endblock %}
	</div>

	<div class="container d-flex flex-column gap-4">
		{% if comments|length == 0 %}
		<div
			class="w-75 fs-4 text-info-emphasis text-bg-warning text-center p-5 mt-5 mx-auto">
			No comments posted yet...be the first!!
		</div>
		{% else %}
		<div class="d-flex flex-column gap-2">
			{% for comment in comments|sort(reverse=true, attribute="created_at") %}
			<div class="card bg-primary-subtle p-2">
				<div class="d-flex align-items-baseline gap-4 ps-2 pb-3">
					<div class="d-flex flex-column gap-1">
						<div class="fs-5">{{ comment.content }}</div>
						<div class="font-monospace text-secondary">
							Posted {% if comment.created_at %} {{
							comment.created_at.strftime("%a, %b %d %Y at %I:%M %p") }} {% else
							%} at an unknown time {% endif %} by {% if comment.user %} {{
							comment.user.username }} {% else %} anonymous {% endif %}
						</div>
					</div>
					<div class="d-flex flex-row gap-2">
						{% if comment.user_id == current_user.id %}
						<form
							action="{{ url_for('delete_comment', comment_id=comment.id) }}"
							method="POST">
							<a
								class="btn btn-sm btn-outline-info text-primary"
								href="{{ url_for('edit_comment', comment_id=comment.id) }}"
								role="button"
								>Edit</a
							>
							<button
								class="btn btn-sm btn-outline-danger"
								type="submit">
								Delete
							</button>
						</form>
						{% endif %}
					</div>
				</div>
				<div class="d-flex align-items-baseline gap-4 ps-2">
					<div class="text-muted fst-italic">
						→ this comment has {% if comment.replies|length == 0 %}
						<strong>no replies</strong>
						{% elif comment.replies|length == 1 and
						current_user.is_authenticated %}
						<a
							class="text-decoration-none"
							href="{{ url_for('replies', comment_id=comment.id) }}"
							><strong>1 reply</strong></a
						>
						{% elif comment.replies|length == 1 and not
						current_user.is_authenticated %}
						<strong>1 reply</strong>
						{% elif comment.replies|length > 1 and current_user.is_authenticated
						%}
						<a
							class="text-decoration-none"
							href="{{ url_for('replies', comment_id=comment.id) }}"
							><strong>{{ comment.replies|length }} replies</strong></a
						>
						{% elif comment.replies|length > 1 and not
						current_user.is_authenticated %}
						<strong>{{ comment.replies|length }} replies</strong>
						{% endif %} and {% if comment.likes|length == 0 %}
						<strong>no likes</strong>
						{% elif comment.likes|length == 1 %}
						<strong>1 like </strong>
						{% else %}
						<strong>{{ comment.likes|length }} likes </strong>
						{% endif %}
					</div>
					{% if current_user.is_authenticated %}
					<div>|</div>
					<div>
						<a
							class="btn btn-outline-primary"
							href="{{ url_for('replies', comment_id=comment.id) }}">
							Reply
						</a>
					</div>
					<div>
						<form
							action="{{ url_for('like_comment', comment_id=comment.id) }}"
							method="POST">
							<input
								class="btn btn-outline-success"
								type="submit"
								value="👍" />
						</form>
					</div>
					{% endif %}
				</div>
			</div>
			{% endfor %}
		</div>
		{% endif %}
	</div>
</div>
{% endblock %}
